# 四、总结

## （一）问题与做法

### 1、问题一

#### （1）理想：文件上传失败时文件不会更新到gundb和上传列表中

#### （2）问题：上传列表中文件依然存在

#### （3）解决：手动修改并调用el-upload内置的删除函数handleRemove，删除上传列表中上传失败的文件并将gundb中响应的文件结点删除

### 2、问题二

#### （1）理想：网页内容适应窗口变化

#### （2）问题：当窗口缩小时文字布局混乱

#### （3）解决：实现响应式布局，当界面缩小到一定程度时采用另一种界面style以动态适应界面变化

### 3、问题三

#### （1）理想：下载文件列表在背景框内

#### （2）问题：当文件名超长时列表超出背景框且出现背景框大小闪烁的问题

#### （3）解决：监控浏览器窗口大小，当窗口缩小到一定程度时文件列表更换style缩小其宽度；当文件列表超出指定长度时多余部分用省略号代替，以控制列表长度

### 4、问题四

#### （1）理想：不允许上传重复文件

#### （2）问题：可以上传重复文件

#### （3）解决：在上传文件时遍历结点查找当前文件列表中是否存在同名文件，存在则调用handleRemove删除已上传的重名文件

### 5、问题五

#### （1）理想：文件上传失败给出一次提示

#### （2）问题：切片上传中每个分块失败均会提示一次上传失败

#### （3）解决：声明变量表示文件是否已经上传失败，若已经提示过则之后的失败均不会提示，同时用该变量判断若已经上传失败则之后切片上传成功也不会提示，且整体不会成功上传

### 6、问题六

#### （1）理想：根据随机生成的ID组成的路由可以访问下载界面

#### （2）问题：下载界面刷新后显示链接不存在

#### （3）解决：原先采用的将所有路由投影到下载界面统一进行判断，经测试，会造成浏览器路由跳转混乱，因此改用将/download/:id投影到下载界面，仅生成的路由可以跳转到下载界面，解决了路由跳转的矛盾

### 7、问题七

#### （1）理想：测试文件可以默认将被测组件及其所引用组件一齐引入

#### （2）问题：引入组件显示不存在

#### （3）解决：需在测试文件开头引入所需引用组件，并设置全局localVue注册，在创建包裹器时将localVue引入即可

### 8、问题八

#### （1）理想：使用设定好的时间戳可以直接对Date类函数进行模拟测试

#### （2）问题：不同的本地时区会直接影响测试结果

#### （3）解决：设定时间戳后应当额外获取一个Date对象决定，依系统本地时间获取适合的测试数据

### 九、问题九

#### （1）理想：所有常见的js函数都可以经由jest进行测试

#### （2）问题：部分函数jest框架并不能解析

#### （3）解决：创建mock函数代替原函数，并伪造返回值（已知返回值情况下）以便程序继续运行检查代码逻辑

### 10、问题十

#### （1）理想：用户在客户端可以自由开启和关闭本地服务器

#### （2）问题：服务器难以在本地部署

#### （3）解决：使用electron的nodejs环境，用脚本运行Gun服务器的自动安装，同时用脚本控制服务器的开关。

### 11、问题十一

#### （1）理想：用户安装客户端可以自定义安装路径

#### （2）问题：客户端会按照默认配置一键安装

#### （3）解决：未发现相关配置文件，经查询发现此版本将配置文件并不是自带的，而是需要自己建立。所以在项目中建立配置文件，将需要的配置写入该文件中即可。

### 12、问题十二

#### （1）理想：用户可以自动连接局域网内的服务器

#### （2）问题：客户端无法找到局域网服务器

####  （3）解决：运用Gun本身的特性，通过脚本找到局域网内的ip，并将其添加到本地的Gun服务器中，通过判断这些ip地址下有没有搭建Gun服务器来确定是否要连接上此节点。

### 13、问题十三

#### （1）理想：使用Gun数据库插入以及更新数据

#### （2）问题：根据Gun的官方文档进行插入，有很多时候插入失败，而且细节等欠缺描述，最后只能自己摸索

#### （3）解决：最后在实践以及询问中，摸索出了一个确保高效插入和更新文件数据的方法，并成功实现文件分块和合并

### 14、问题十四

#### （1）理想：使用Gun异步回调函数实现一些功能

#### （2）问题：Gun数据库的回调函数应该是异步的，也就是说发送插入或者删除请求，需要一定时间才能收到请求，调用函数，而且期间无法阻塞。异步回调带来的最大困扰就是在一些验证上（比如查询密码、查询文件是否存在）无法及时得到反馈而且在一些具有严格先后顺序的程序中（比如文件分块，必须严格遵守先插入顺序），无法阻塞。

#### （3）解决：至今仍然未探索出使其阻塞的方法，最后不得已在连续的插入中使用计时函数进行缓冲，同时放弃以数组的形式进行插入，而是使用键值对进行文件对象的更新。同时将验证函数放在Gun的回调函数之内，确保回调函数执行后，程序才能继续运行。
### 15、问题十五

#### （1）理想：按照官方文档正确使用Gun

#### （2）问题：Gun中有时候会有莫名的报错信息，Gun数据库通过回调函数来判断数据是否成功插入或者失败插入，但是经过实践：即使插入失败，也就是回调函数出现错误，文件本身的数据也没有受到任何的影响，仍然可以正确获取和下载。这样带来的困扰就是根本无法判断它什么时候插入失败。

#### （3）解决：最终还未解决这个问题，反而是直接放弃判断插入是否成功或失败。因为经过实践，数据插入的过程中，即使全部报错，最终体现在数据库的仍然是正确的文件信息，可以正确上传和下载。

## （二）总结与沉淀
        本次的项目是一个特殊的开源项目， 此项目核心技术是Gun，Gun是一个实时的、分布式的、离线优先的图形数据库引擎，同时也是一项较为新兴和较少人使用的技术。而且由于其比较小众，可供学习的文档基本只有官方的文档，在网络上资料匮乏的情况下，需要从一无所知到熟练操作，考验的是我们应对问题的解决方法以及学习能力。第一次接触开源社区，第一次接触图形数据库，第一次进行项目测试，第一次使用Electron作为搭建客户端工具，让一个项目变成了可以在电脑上安装的软件。
        在开发过程中遇到了许多困难，无论是在建立服务器、进行测试还是实现核心功能等方面，大家都是花了不少功夫才解决。这是第一次大家真正意义上的团队合作，从之前的各自埋头苦干到后面交流合作，使工作效率提高了很多。每周的小组展示对我们帮助很大，我们看见了别的小组的不足和优点，对比我们小组，促使我们更好的开发项目，同时也会和和别的小组进行一些方法的探讨。小组成员之间互相交流，明确任务分配，每天晚上固定时间开会，汇报工作进度，疑难问题探讨，合力攻破难关。在这些过程中，我们学会了怎样更好的团结协作。
       在真正接触到开源项目和开源社区之后，我们也对软件技术开发以及开源世界有了更加深刻的了解。同时，在寻找解决方法的过程中，由于没有过多资料以及其他人的经验，我们只能在实践中进行验证，在摸索中成长，也在某种意义上契合了我们“实训”的目的。总之，最后我们能做出来一个相对完整的项目，尽管它不完美，但已经足够证明我们的努力与汗水。

